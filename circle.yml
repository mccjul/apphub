general:
 artifacts:
    - "~/build_output.zip" # Save APK's, Lint Results, and Test Results

machine:
  xcode:
    version: "7.0"

dependencies:
  pre:
    - brew install npm
    - brew uninstall xctool && brew install xctool
    - echo y | android update sdk -u -a -t android-22
    - echo y | android update sdk -u -a -t platform-tools
    - echo y | android update sdk -u -a -t build-tools-21.1.2
    - echo y | android update sdk -u -a -t "extra-android-m2repository"
    - echo y | android update sdk -u -a -t "extra-android-support"
    - echo y | android update sdk -u -a -t "extra-google-m2repository"
    - echo no | android create avd -n testAVD -f -t android-22 --abi default/armeabi-v7a
  override:
    - cd android && ./gradlew dependencies --stacktrace

test:
  pre:
    - emulator -avd circleci-android22 -no-audio -no-window:
        background: true
        parallel: true

  override:
    - cd android && ./gradlew test --info
    - zip -r ~/build_output.zip app/build/outputs/
